// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(cuid())
  nome      String
  email     String   @unique
  senha     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  wallets         Wallet[]
  transactions    Transaction[]
  sharedContracts SharedContractParticipant[]

  @@map("users")
}

model Wallet {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  saldo     Float    @default(0)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("wallets")
}

model Transaction {
  id        String   @id @default(cuid())
  walletId  String   @map("wallet_id")
  userId    String   @map("user_id")
  tipo      String
  valor     Float
  status    String   @default("PENDING")
  descricao String?
  metadata  String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  wallet Wallet @relation(fields: [walletId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model SharedContract {
  id           String   @id @default(cuid())
  valorTotal   Float    @map("valor_total")
  status       String   @default("ACTIVE")
  descricao    String?
  metadata     String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  participants SharedContractParticipant[]

  @@map("shared_contracts")
}

model SharedContractParticipant {
  id               String   @id @default(cuid())
  sharedContractId String   @map("shared_contract_id")
  userId           String   @map("user_id")
  valorParticipacao Float   @map("valor_participacao")
  status           String   @default("PENDING")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  // Relacionamentos
  sharedContract SharedContract @relation(fields: [sharedContractId], references: [id], onDelete: Cascade)
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([sharedContractId, userId])
  @@map("shared_contract_participants")
}

// Enums removidos para compatibilidade com SQLite
// Valores v치lidos para tipo: DEPOSITO, SAQUE, TRANSFERENCIA, PAGAMENTO_COMPARTILHADO
// Valores v치lidos para status: PENDING, COMPLETED, FAILED, CANCELLED
// Valores v치lidos para status de contrato: ACTIVE, COMPLETED, CANCELLED, EXPIRED
// Valores v치lidos para status de participante: PENDING, CONFIRMED, PAID, CANCELLED
